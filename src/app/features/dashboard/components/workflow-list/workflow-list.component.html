<section class="view">
  <header class="view__header">
    <div>
      <h2>Workflow List</h2>
      <p>Manage all your automation workflows.</p>
    </div>
    <button type="button" class="btn btn-gradient" (click)="triggerNewWorkflow()">
      <mat-icon>add</mat-icon>
      New Workflow
    </button>
  </header>

  <div class="stats-grid">
    <div class="card stats-card">
      <div class="stats-card__content">
        <p>Total Workflows</p>
        <span>{{ stats.total }}</span>
      </div>
      <div class="stats-card__icon stats-card__icon--blue">
        <mat-icon>play_circle</mat-icon>
      </div>
    </div>

    <div class="card stats-card">
      <div class="stats-card__content">
        <p>Active</p>
        <span>{{ countByStatus('active') }}</span>
      </div>
      <div class="stats-card__icon stats-card__icon--green">
        <mat-icon>check_circle</mat-icon>
      </div>
    </div>

    <div class="card stats-card">
      <div class="stats-card__content">
        <p>Paused</p>
        <span>{{ countByStatus('paused') }}</span>
      </div>
      <div class="stats-card__icon stats-card__icon--yellow">
        <mat-icon>pause_circle</mat-icon>
      </div>
    </div>

    <div class="card stats-card">
      <div class="stats-card__content">
        <p>Errors</p>
        <span>{{ countByStatus('error') }}</span>
      </div>
      <div class="stats-card__icon stats-card__icon--red">
        <mat-icon>error</mat-icon>
      </div>
    </div>
  </div>

  <div class="search-bar">
    <mat-icon>search</mat-icon>
    <input
      type="search"
      placeholder="Search workflows..."
      [(ngModel)]="searchQuery"
      (ngModelChange)="onSearchChange()"
      [disabled]="isLoading"
    />
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <mat-icon class="spinner">refresh</mat-icon>
    <p>Loading workflows...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <mat-icon>error_outline</mat-icon>
    <p>{{ error }}</p>
    <button type="button" class="btn btn-gradient" (click)="loadWorkflows()">
      <mat-icon>refresh</mat-icon>
      Retry
    </button>
  </div>

  <div class="card table-card" *ngIf="!isLoading && !error">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Workflow Name</th>
            <th>Status</th>
            <th>Trigger</th>
            <th>Videos Created</th>
            <th>Next Run</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let workflow of filteredWorkflows">
            <td>
              <div class="workflow-cell">
                <div class="workflow-cell__icon">
                  <mat-icon>play_arrow</mat-icon>
                </div>
                <div>
                  <p>{{ workflow.name }}</p>
                  <small>ID: {{ workflow.id }}</small>
                </div>
              </div>
            </td>
            <td>
              <span class="badge badge-outline" [ngClass]="statusClass(workflow.status)">
                <mat-icon>{{ statusIcon(workflow.status) }}</mat-icon>
              <span class="capitalize">{{ workflow.status }}</span>
            </span>
          </td>
          <td>
              <div class="trigger-cell">
                <mat-icon>schedule</mat-icon>
                {{ workflow.trigger }}
              </div>
            </td>
            <td>
              <span class="strong">{{ workflow.videosCreated }}</span>
            </td>
            <td>
              <span class="muted">{{ workflow.nextRun }}</span>
            </td>
            <td>
              <div class="actions">
                <button 
                  type="button" 
                  class="btn btn-ghost"
                  (click)="toggleWorkflowStatus(workflow)"
                  [disabled]="isLoading"
                  [title]="workflow.status.toLowerCase() === 'active' ? 'Pause workflow' : 'Resume workflow'"
                >
                  <mat-icon>{{ workflow.status.toLowerCase() === 'active' ? 'pause' : 'play_arrow' }}</mat-icon>
                </button>
                <button type="button" class="btn btn-ghost">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button 
                  type="button" 
                  class="btn btn-ghost"
                  (click)="editWorkflowHandler(workflow.id)"
                  [title]="'Edit workflow'"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button type="button" class="btn btn-ghost danger">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <p *ngIf="!isLoading && !error && filteredWorkflows.length === 0" class="empty-state">
    <ng-container *ngIf="searchQuery; else noWorkflows">
      No workflows found matching "{{ searchQuery }}".
    </ng-container>
    <ng-template #noWorkflows>
      No workflows found. Create your first workflow to get started.
    </ng-template>
  </p>
</section>


